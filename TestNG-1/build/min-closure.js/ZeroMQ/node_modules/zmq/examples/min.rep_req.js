'use strict';var cluster=require("cluster"),zmq=require("../"),port="tcp://127.0.0.1:12345";
if(cluster.isMaster){for(var i=0;2>i;i++)cluster.fork();cluster.on("death",function(a){console.log("worker "+a.pid+" died")});var socket=zmq.socket("rep");socket.identity="server"+process.pid;socket.bind(port,function(a){if(a)throw a;console.log("bound!");socket.on("message",function(a){console.log(socket.identity+": received "+a.toString());socket.send(2*a)})})}else socket=zmq.socket("req"),socket.identity="client"+process.pid,socket.connect(port),console.log("connected!"),setInterval(function(){var a=
Math.floor(100*Math.random());socket.send(a);console.log(socket.identity+": asking "+a)},100),socket.on("message",function(a){console.log(socket.identity+": answer data "+a)});