'use strict';var cluster=require("cluster"),zeromq=require("../"),port="tcp://127.0.0.1:12345";
if(cluster.isMaster){for(var i=0;2>i;i++)cluster.fork();cluster.on("death",function(a){console.log("worker "+a.pid+" died")});var socket=zeromq.socket("router");socket.identity="server"+process.pid;socket.bind(port,function(a){if(a)throw a;console.log("bound!");socket.on("message",function(a,b){console.log(socket.identity+": received "+a+" - "+b.toString());socket.send([a,2*b])})})}else socket=zeromq.socket("dealer"),socket.identity="client"+process.pid,socket.connect(port),console.log("connected!"),
setInterval(function(){var a=Math.floor(100*Math.random());socket.send(a);console.log(socket.identity+": asking "+a)},100),socket.on("message",function(a){console.log(socket.identity+": answer data "+a)});