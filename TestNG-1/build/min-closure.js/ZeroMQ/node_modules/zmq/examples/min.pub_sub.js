'use strict';var cluster=require("cluster"),zmq=require("../"),port="tcp://127.0.0.1:12345";
if(cluster.isMaster){for(var i=0;2>i;i++)cluster.fork();cluster.on("death",function(a){console.log("worker "+a.pid+" died")});var socket=zmq.socket("pub");socket.identity="publisher"+process.pid;var stocks=["AAPL","GOOG","YHOO","MSFT","INTC"];socket.bind(port,function(a){if(a)throw a;console.log("bound!");setInterval(function(){var a=stocks[Math.floor(Math.random()*stocks.length)],b=1E3*Math.random();console.log(socket.identity+": sent "+a+" "+b);socket.send(a+" "+b)},100)})}else socket=zmq.socket("sub"),
socket.identity="subscriber"+process.pid,socket.connect(port),socket.subscribe("AAPL"),socket.subscribe("GOOG"),console.log("connected!"),socket.on("message",function(a){console.log(socket.identity+": received data "+a.toString())});