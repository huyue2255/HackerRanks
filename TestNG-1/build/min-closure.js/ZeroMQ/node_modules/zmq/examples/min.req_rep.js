'use strict';var cluster=require("cluster"),zeromq=require("../"),port="tcp://127.0.0.1:12345";
if(cluster.isMaster){for(var i=0;2>i;i++)cluster.fork();cluster.on("death",function(a){console.log("worker "+a.pid+" died")});var socket=zeromq.socket("req");socket.identity="client"+process.pid;socket.bind(port,function(a){if(a)throw a;console.log("bound!");setInterval(function(){var a=Math.floor(100*Math.random());console.log(socket.identity+": asking "+a);socket.send(a)},100);socket.on("message",function(a){console.log(socket.identity+": answer data "+a)})})}else socket=zeromq.socket("rep"),socket.identity=
"server"+process.pid,socket.connect(port),console.log("connected!"),socket.on("message",function(a){console.log(socket.identity+": received "+a.toString());socket.send(2*a)});