'use strict';var zmq=require("../"),assert=require("assert");5!=process.argv.length&&(console.log("usage: remote_lat \x3cconnect-to\x3e \x3cmessage-size\x3e \x3croundtrip-count\x3e"),process.exit(1));var connect_to=process.argv[2],message_size=Number(process.argv[3]),roundtrip_count=Number(process.argv[4]),message=new Buffer(message_size);message.fill("h");var recvCounter=0,req=zmq.socket("req");req.connect(connect_to);var timer;
req.on("message",function(a){timer||(console.log("started receiving"),timer=process.hrtime());assert.equal(a.length,message_size,"message-size did not match");++recvCounter===roundtrip_count?finish():send()});
function finish(){var a=process.hrtime(timer),b=1E3*a[0]+a[1]/1E6;console.log("message size: %d [B]",message_size);console.log("roundtrip count: %d",roundtrip_count);console.log("mean latency: %d [msecs]",b/(2*roundtrip_count));console.log("overall time: %d secs and %d nanoseconds",a[0],a[1]);req.close()}function send(){req.send(message)}send();