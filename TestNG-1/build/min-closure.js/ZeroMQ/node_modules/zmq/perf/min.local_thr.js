'use strict';var zmq=require("../"),assert=require("assert");5!=process.argv.length&&(console.log("usage: local_thr \x3cbind-to\x3e \x3cmessage-size\x3e \x3cmessage-count\x3e"),process.exit(1));var bind_to=process.argv[2],message_size=Number(process.argv[3]),message_count=Number(process.argv[4]),counter=0,sock=zmq.socket("pull");sock.bindSync(bind_to);var timer;
sock.on("message",function(a){timer||(console.log("started receiving"),timer=process.hrtime());assert.equal(a.length,message_size,"message-size did not match");++counter===message_count&&finish()});
function finish(){var a=process.hrtime(timer),b=message_count/(a[0]+a[1]/1E9),c=b*message_size*8/1E6;console.log("message size: %d [B]",message_size);console.log("message count: %d",message_count);console.log("mean throughput: %d [msg/s]",b.toFixed(0));console.log("mean throughput: %d [Mbit/s]",c.toFixed(0));console.log("overall time: %d secs and %d nanoseconds",a[0],a[1]);sock.close()};