'use strict';var zmq=require(".."),should=require("should"),semver=require("semver"),addr="tcp://127.0.0.1",frontendAddr=addr+":5501",backendAddr=addr+":5502",captureAddr=addr+":5503";
describe("proxy.push-pull",function(){it("should proxy push-pull connected to pull-push",function(f){var b=zmq.socket("pull"),c=zmq.socket("push"),d=zmq.socket("pull"),a=zmq.socket("push");b.bindSync(frontendAddr);c.bindSync(backendAddr);a.connect(frontendAddr);d.connect(backendAddr);d.on("message",function(e){b.close();c.close();a.close();d.close();e.should.be.an.instanceof(Buffer);e.toString().should.equal("foo");f()});setTimeout(function(){a.send("foo")},100);zmq.proxy(b,c)});it("should proxy pull-push connected to push-pull with capture",
function(f){var b=zmq.socket("push"),c=zmq.socket("pull"),d=zmq.socket("pub"),a=zmq.socket("sub"),e=zmq.socket("pull"),g=zmq.socket("push");b.bindSync(frontendAddr);c.bindSync(backendAddr);d.bindSync(captureAddr);e.connect(frontendAddr);g.connect(backendAddr);a.connect(captureAddr);e.on("message",function(a){a.should.be.an.instanceof(Buffer);a.toString().should.equal("foo")});a.subscribe("");a.on("message",function(h){d.close();a.close();setTimeout(function(){b.close();c.close();g.close();e.close();
h.should.be.an.instanceof(Buffer);h.toString().should.equal("foo");f()},100)});setTimeout(function(){g.send("foo")},100);zmq.proxy(b,c,d)})});