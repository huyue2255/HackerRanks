'use strict';var zmq=require(".."),should=require("should"),semver=require("semver"),addr="tcp://127.0.0.1",frontendAddr=addr+":5510",backendAddr=addr+":5511",captureAddr=addr+":5512",version=semver.lte(zmq.version,"3.0.0");
describe("proxy.xrep-xreq",function(){it("should proxy req-rep connected to xrep-xreq",function(e){if(!version)return console.warn("Test requires libzmq v2 (skipping)"),e();var c=zmq.socket("xrep"),d=zmq.socket("xreq"),a=zmq.socket("req"),b=zmq.socket("rep");c.bindSync(frontendAddr);d.bindSync(backendAddr);a.connect(frontendAddr);b.connect(backendAddr);a.on("message",function(f){f.should.be.an.instanceof(Buffer);f.toString().should.equal("foo bar");c.close();d.close();a.close();b.close();e()});b.on("message",
function(a){b.send(a+" bar")});setTimeout(function(){a.send("foo")},100);zmq.proxy(c,d)})});