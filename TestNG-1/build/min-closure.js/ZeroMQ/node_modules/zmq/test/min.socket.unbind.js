'use strict';var zmq=require(".."),should=require("should"),semver=require("semver");
describe("socket.unbind",function(){it("should be able to unbind",function(e){if(zmq.ZMQ_CAN_UNBIND){var b=zmq.socket("dealer"),d=zmq.socket("dealer"),c=zmq.socket("dealer"),f=0;b.bind("tcp://127.0.0.1:5420",function(a){if(a)throw a;b.bind("tcp://127.0.0.1:5421",function(a){if(a)throw a;d.connect("tcp://127.0.0.1:5420");d.send("Hello from b.");c.connect("tcp://127.0.0.1:5421");c.send("Hello from c.")})});b.on("unbind",function(a){"tcp://127.0.0.1:5420"===a&&(d.send("Error from b."),c.send("Messsage from c."),
setTimeout(function(){c.send("Final message from c.")},100))});b.on("message",function(a){f++;if("Hello from b."===a.toString())b.unbind("tcp://127.0.0.1:5420",function(a){if(a)throw a;});else if("Final message from c."===a.toString())f.should.equal(4),b.close(),d.close(),c.close(),e();else if("Error from b."===a.toString())throw Error("b should have been unbound");})}else e()})});