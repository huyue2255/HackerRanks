'use strict';var zmq=require(".."),should=require("should"),semver=require("semver");
describe("socket.pub-sub",function(){var b,c;beforeEach(function(){b=zmq.socket("pub");c=zmq.socket("sub")});it("should support pub-sub",function(d){var e=0;c.subscribe("");c.on("message",function(a){a.should.be.an.instanceof(Buffer);switch(e++){case 0:a.toString().should.equal("foo");break;case 1:a.toString().should.equal("bar");break;case 2:a.toString().should.equal("baz"),c.close(),b.close(),d()}});c.bind("inproc://stuff_ssps",function(a){if(a)throw a;b.connect("inproc://stuff_ssps");setTimeout(function(){b.send("foo");
b.send("bar");b.send("baz")},100)})});it("should support pub-sub filter",function(d){var e=0;c.subscribe("js");c.subscribe("luna");c.on("message",function(a){a.should.be.an.instanceof(Buffer);switch(e++){case 0:a.toString().should.equal("js is cool");break;case 1:a.toString().should.equal("luna is cool too"),c.close(),b.close(),d()}});c.bind("inproc://stuff_sspsf",function(a){if(a)throw a;b.connect("inproc://stuff_sspsf");setTimeout(function(){b.send("js is cool");b.send("ruby is meh");b.send("py is pretty cool");
b.send("luna is cool too")},100)})})});