'use strict';var zmq=require(".."),should=require("should"),semver=require("semver"),addr="tcp://127.0.0.1",frontendAddr=addr+":5504",backendAddr=addr+":5505",captureAddr=addr+":5506";
describe("proxy.router-dealer",function(){it("should proxy req-rep connected over router-dealer",function(g){var c=zmq.socket("router"),d=zmq.socket("dealer"),b=zmq.socket("rep"),a=zmq.socket("req");c.bindSync(frontendAddr);d.bindSync(backendAddr);a.connect(frontendAddr);b.connect(backendAddr);a.on("message",function(e){e.should.be.an.instanceof(Buffer);e.toString().should.equal("foo bar");c.close();d.close();a.close();b.close();g()});b.on("message",function(a){b.send(a+" bar")});setTimeout(function(){a.send("foo")},
100);zmq.proxy(c,d)});it("should proxy rep-req connections with capture",function(g){var c=zmq.socket("router"),d=zmq.socket("dealer"),b=zmq.socket("rep"),a=zmq.socket("req"),e=zmq.socket("pub"),f=zmq.socket("sub");c.bindSync(frontendAddr);d.bindSync(backendAddr);e.bindSync(captureAddr);a.connect(frontendAddr);b.connect(backendAddr);f.connect(captureAddr);f.subscribe("");a.on("message",function(c){a.close();b.close()});b.on("message",function(a){b.send(a+" bar")});f.on("message",function(a){d.close();
c.close();e.close();f.close();setTimeout(function(){a.should.be.an.instanceof(Buffer);a.toString().should.equal("foo bar");g()},100)});setTimeout(function(){a.send("foo")},200);zmq.proxy(c,d,e)})});